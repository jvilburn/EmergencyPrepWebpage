<!DOCTYPE html>
<html>
<head>
  <title>Ward Directory Map - Offline Edition</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar">
    <div class="sidebar-header">
      <button class="hamburger-menu" title="Menu">☰</button>
      <h3>📋 Households</h3>
      <button class="sidebar-toggle" title="Collapse sidebar">◀</button>
    </div>
    
    <!-- Hamburger Menu -->
    <div class="hamburger-dropdown" id="hamburgerMenu">
      <div class="menu-section">
        <h4>📁 File Operations</h4>
        <button>📂 Load CSV</button>
        <button>💾 Save CSV</button>
        <button>🗺️ Export Missing Tiles</button>
        <button>🔍 Check Missing Count</button>
        <button>📋 Download Instructions</button>
      </div>
      <div class="menu-section">
        <h4>📊 View</h4>
        <button>📈 Statistics</button>
        <button>🎨 Legend</button>
        <button>🏠 Reset View</button>
        <button id="clusterMenuBtn">👁️ Toggle Clusters</button>
      </div>
      <div class="menu-section">
        <h4>✏️ Edit</h4>
        <button>🗺️ Manage Regions</button>
        <button>📝 View Changes</button>
        <button>↶ Undo Last</button>
        <button>🔦 Clear Highlights</button>
        <button>🗑️ Clear Missing Tiles</button>
      </div>
    </div>
    <div class="sidebar-controls">
      <input type="text" class="search-box" id="searchBox" placeholder="Search households..." onkeyup="filterHouseholds()">
      
      <!-- Collapsible Household List -->
      <div class="collapsible-section">
        <div class="collapsible-header">
          <span>👥 Household List</span>
          <span class="expand-icon" id="householdListIcon">▶</span>
        </div>
        <div class="collapsible-content collapsed" id="householdListSection">
          <div class="sort-buttons">
            <button class="sort-btn active">By Name</button>
            <button class="sort-btn">By Communication Region</button>
          </div>
          <ul class="household-list" id="householdList"></ul>
        </div>
      </div>
      
      <!-- Collapsible Resource Filters -->
      <div class="collapsible-section">
        <div class="collapsible-header">
          <span>🔧 Resource Filters</span>
          <span class="expand-icon" id="resourceFiltersIcon">▶</span>
        </div>
        <div class="collapsible-content collapsed" id="resourceFiltersSection">
          <div class="resource-filters-grid" id="dynamicFiltersGrid">
            <div class="loading-filters">Load household data to see available filters</div>
          </div>
        </div>
      </div>
    </div>
    <div class="sidebar-footer" id="sidebarFooter">
      0 households loaded
    </div>
  </div>
  
  <!-- Map Container -->
  <div id="map"></div>
  
  
  <!-- Hidden File Input -->
  <input type="file" id="fileInput" accept=".csv" style="display: none;">
  
  <!-- Bottom Status Bar -->
  <div class="status-bar" id="statusBar">
    <span id="statusMessage">Ready - Load CSV to begin</span>
    <span id="connectivityIndicator" class="connectivity-indicator">🔍 Checking connectivity...</span>
    <span id="changesIndicator" class="hidden">📝 0 changes</span>
  </div>
  
  <!-- Household Edit Dialog -->
  <div class="modal-overlay" id="modalOverlay"></div>
  <div class="household-edit-dialog" id="householdEditDialog">
    <div class="dialog-header">
      <h3>Edit Household</h3>
      <div id="selectedHousehold" class="household-info"></div>
      <div id="currentAssignment" class="current-assignment"></div>
    </div>
    
    <div class="household-options" id="householdOptions"></div>
    
    <div class="dialog-buttons">
      <button class="btn btn-secondary" id="cancelHouseholdBtn">Cancel</button>
      <button class="btn btn-primary" id="confirmHouseholdBtn">Save Changes</button>
    </div>
  </div>
  
  <!-- Load external dependencies -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  
  <!-- Tile Manifests -->
  <script src="tiles/osm-manifest.js"></script>
  <script src="tiles/satellite-manifest.js"></script>
  
  <!-- Load application modules -->
  <!-- Foundation layer -->
  <script src="household.js"></script>
  <script src="state-manager.js"></script>
  <script src="status-manager.js"></script>
  <script src="data-layer.js"></script>
  
  <!-- Core modules -->
  <script src="map-manager.js"></script>
  <script src="tile-manager.js"></script>
  <script src="file-manager.js"></script>
  
  <!-- UI modules (load in dependency order) -->
  <script src="ui/sidebar.js"></script>
  <script src="ui/household-list.js"></script>
  <script src="ui/resource-filters.js"></script>
  <script src="ui/highlighting.js"></script>
  <script src="ui/ui-manager.js"></script>
  
  <!-- Additional modules -->
  <script src="region-cluster-manager-class.js"></script>
  <script src="event-manager.js"></script>
  
  <!-- Application initialization -->
  <script src="app.js"></script>
  <script src="app-bootstrap.js"></script>
</body>
</html>